## 案例7-1 使用JDBC完成数据的增删改查

### 一、案例描述

1、 考核知识点

名称：使用JDBC完成数据的增删改查

编号：028009006

2、 练习目标

Ø 掌握JDBC常用接口的使用

Ø 掌握PreparedStatement对象的使用

Ø 掌握ResultSet对象的使用

3、 需求分析

Statement对象每次执行SQL语句时，都会对其进行编译。当相同的SQL语句执行多次时，Statement对象就会使数据库频繁编译相同的SQL语句，从而降低数据库的访问效率。为了解决这个问题，Statement提供了一个子类PreparedStatement。PreparedStatement对象可以对SQL语句进行预编译，预编译的信息会存储在PreparedStatement对象中。当相同的SQL语句再次执行时，程序会使用PreparedStatement对象中的数据，而不需要对SQL语句再次编译去查询数据库，这样就大大的提高了数据的访问效率。接下来，本案例将使用PreparedStatement对象来完成对数据的增删改查操作。 

4、 设计思路（实现原理）

1）       创建一个用于封装数据的JavaBean。

2）       将加载驱动和获取数据连接等操作封装在一个工具类中，以供其他类调用。

3）       创建一个实现了对数据库添删改查操作的DAO

4）       分别创建用于执行对数据表添删改查操作的测试类。

5）       执行程序，测试结果。

### 二、案例实现

**1****．创建JavaBean**

创建一个用于保存用户数据的User类，User类的具体实现方式如下所示。

import java.util.Date;

public class User {

  private int id;

  private String username;

  private String password;

  private String email;

  private Date birthday;

  **//****补充各属性的getter/setter****方法**

**2****．创建工具类**

由于每次操作数据库时，都需要加载数据库驱动、建立数据库连接以及关闭数据库连接，为了避免代码的重复书写，下面建立一个专门用于数据库相关操作的工具类JDBCUtils，JDBCUtils的具体实现方式如下所示。

import java.sql.*;

public class JDBCUtils {

  // 加载驱动，并建立数据库连接

  public static Connection getConnection() throws SQLException,

​      ClassNotFoundException {

​     **//****补充代码**

  }

  // 关闭数据库连接，释放资源

  public static void release(PreparedStatement prestmt, Connection conn,

​      ResultSet rs) {

​    **//****补充代码**

}

**3****．创建****DAO**

创建一个名称为UsersDao的类，该类中封装了对表users的添加、查询、删除和更新等操作，具体实现方式如下所示。

import java.sql.*;

import java.text.SimpleDateFormat;

import java.util.ArrayList;

public class UsersDao {

  // 添加用户的操作

  public boolean insert(User user) {

   **//****补充代码**

  }

  // 查询所有的User对象

  public ArrayList<User> findAll() {

​     **//****补充代码**

  }

  // 根据id查找指定的user

  public User find(int id) {

​    **//****补充代码**

  }

  // 删除用户

  public boolean delete(int id) {

   **//****补充代码**

  }

  // 修改用户

  public boolean update(User user) {

​    **//****补充代码**

}

}

**4****．创建测试类**

（1）编写测试类JdbcInsertTest，实现向users表中添加一条数据，其代码如下所示。

import java.util.Date;

public class InsertUserTest{

  public static void main(String[] args) {

​     // 向users表插入一个用户信息

​    UsersDao ud = new UsersDao();

​    User user=new User();

​      user.setId(5);

​      user.setUsername("hym");

​      user.setPassword("1234");

​      user.setEmail("hym@sina.com");

​      user.setBirthday(new Date());

​      boolean b=ud.insert(user);

​      System.out.println(b);

​    }

}

在运行程序之前，先来查询下users表中的数据，如下图所示。

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)

运行程序后，如果控制台的打印结果为true，说明添加用户信息的操作执行成功了。这时，再次查询users表，其查询结果如下图所示：

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

图9-1      查询结果

从上图的查询结果可以看出，users表中添加了一条name为hym的数据。

（2）编写测试类FindAllUsersTest，该类用于实现读取users表中所有的数据，其代码如下所示。

import java.util.ArrayList;

public class FindAllUsersTest {

  public static void main(String[] args) {

​    // 创建一个名称为usersDao的对象

​    UsersDao usersDao = new UsersDao();

​    // 将UsersDao对象的findAll()方法执行后的结果放入list集合

​    ArrayList<User> list = usersDao.findAll();

​    // 循环输出集合中的数据

​    for (int i = 0; i < list.size(); i++) {

​      System.out.println("第" + (i + 1) + "条数据的username值为:"

​          \+ list.get(i).getUsername());

​    }

  }

}

程序执行后，控制台会打印出users表中所有的username值，结果如下图所示。

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

（3）编写测试类FindUserByIdTest，该类实现了读取users表中指定的数据，其代码如下所示。

public class FindUserByIdTest{

  public static void main(String[] args) {

  UsersDao usersDao = new UsersDao();

  User user = usersDao.find(5);

  System.out.println("id为5的User对象的name值为："+user.getUsername());

  }

}

程序执行后，控制台会将id为5的User对象的name值打印出来，结果如下图所示。

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)

图9-2      运行结果

（4）编写测试类UpdateUserTest，该类实现了修改users表中数据的操作，具体代码如下所示。

import java.util.Date;

public class UpdateUserTest {

  public static void main(String[] args) {

​    // 修改User对象的数据

​    UsersDao usersDao = new UsersDao();

​    User user = new User();

​    user.setId(5);

​    user.setUsername("hanyongmeng");

​    user.setPassword("123456");

​    user.setEmail("hanyongmeng@sina.com");

​    user.setBirthday(new Date());

​    boolean b = usersDao.update(user);

​    System.out.println(b);

  }

}

执行上传程序后，如果控制台打印结果为true，说明已经执行了修改用户信息的操作，这时，再查看users表，查询结果如下图所示：

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)

从上图的查询结果可以看出，id为5的User对象的信息已经发生了变化。

（5）编写测试类DeleteUserTest，该类实现了删除users表中数据的操作，其代码如下所示。

public class DeleteUserTest{

  public static void main(String[] args) {

​    // 删除操作

​    UsersDao usersDao = new UsersDao();

​    boolean b = usersDao.delete(5);

​    System.out.println(b);

  }

}

运行上述程序后，如果控制台打印结果为true，说明删除用户信息的操作执行成功，这时，查看users表中的数据，结果如下图所示：

![img](file:///C:/Users/SQUARES/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg)

从上图中可以看出，users表中id为5的User对象已被成功删除了。至此，使用JDBC对数据库中数据进行增删改查的操作已经完成。

 